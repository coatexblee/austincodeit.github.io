$(document).ready(function(){let createFinalPDF=function(){let $directionsText=$('#directions-panel')[0];let pdfOptions={orientation:"portrait",unit:"mm",format:"letter"};let pdf=new jsPDF(pdfOptions);pdf.setFont("helvetica");pdf.setTextColor(0,0,0);pdf.setLineWidth(0.5);let left_margin=16;const PAGE_HEIGHT=280;const PAGE_WIDTH=200;let content_margin=40;let page_count=1;let labels='ABCDEFGHIJKLMNOPQRSTUVWXYZ';let getRightMargin=function(obj){return PAGE_WIDTH-(obj.length*2);}
let createMarkerArray=function(markerArray){let finalString='';for(let i=0;i<markerArray.length;i++){if(i==markerArray.length-1){finalString+="&markers=color:green%7Clabel:"+labels[i%labels.length]+"%7C"+String(markerArray[i].lat)+","+String(markerArray[i].lng);}else{finalString+="&markers=color:red%7Clabel:"+labels[i%labels.length]+"%7C"+String(markerArray[i].lat)+","+String(markerArray[i].lng);}}
return finalString}
let addLine=function(lineType,yValue){if(lineType=="thin"){pdf.setLineWidth(0.25);pdf.setDrawColor(200,200,200);pdf.line(left_margin,yValue,PAGE_WIDTH,yValue);}else{pdf.setLineWidth(0.5);pdf.setDrawColor(15,15,15);pdf.line(left_margin,yValue,PAGE_WIDTH,yValue);}}
let addHeader=function(){pdf.setFontSize(14);pdf.text(left_margin,20,global_pdf.name);pdf.setFontSize(10);pdf.text(left_margin,27,''+global_pdf.start+' to '+global_pdf.end);pdf.text(getRightMargin(global_pdf.datestamp),20,""+global_pdf.datestamp);pdf.text(getRightMargin(global_pdf.timestamp),27,""+global_pdf.timestamp);addLine("header",30);pdf.addImage(codeImgURL,'JPEG',PAGE_WIDTH/2,5,18,18);addFooter();}
let addFooter=function(){pdf.setFontSize(8);pdf.setTextColor(70,70,70);let footerText='City of Austin | Open Data Portal | jsPDF | GitHub'
let footerMargin=PAGE_WIDTH/2-20;let footerHeight=PAGE_HEIGHT-18;pdf.text(footerMargin,footerHeight,footerText);pdf.text(PAGE_WIDTH,footerHeight,String(page_count));pdf.setFontType("normal");pdf.setFontSize(10);pdf.setTextColor(0,0,0);}
let $element=$('#sampleImg');let $mapElement=$('#map');let mapWidth=640
let mapHeight=400
let google_1="https://maps.googleapis.com/maps/api/staticmap";let google_2="?center="+global_pdf.map_center;let google_3="&zoom="+global_pdf.map_zoom;let google_4="&size=640x400";let google_5=createMarkerArray(global_pdf.route_stops);let google_6="&path=weight:4%7Ccolor:blue%7Cenc:"+global_pdf.route_path;let google_k="&key=AIzaSyCSjAnT5cJ03MwURghAT1nZrLz4InNRpP0";let pdfImgWidth=mapWidth*(184/mapWidth);let pdfImgHeight=mapHeight*(105/mapHeight);let picMarginX=10+PAGE_WIDTH/2;let picMarginY=content_margin-10;function addGoogleMapImage(){let $canvas=document.getElementById("canvasImg")
let ctx=$canvas.getContext('2d');;let img=new Image();img.onload=function(){$canvas.width=mapWidth;$canvas.height=mapHeight;ctx.drawImage(img,0,0,mapWidth,mapHeight);let dataUrl=$canvas.toDataURL('image/png',1.0);pdf.addImage(dataUrl,'JPEG',left_margin,content_margin-5,pdfImgWidth,pdfImgHeight);pdf.setFontType("bold");pdf.text(left_margin,content_margin+pdfImgHeight+20,'Trip Time: '+global_pdf.trip_time+" minutes");pdf.text(left_margin+80,content_margin+pdfImgHeight+20,'Trip Distance: '+global_pdf.trip_dist+" miles");pdf.setFontType("normal");page_count=page_count+1;addTaskContents();}
img.crossOrigin="anonymous";img.src=google_1+google_2+google_3+google_4+google_5+google_6+"&maptype=roadmap"+google_k;}
function addTaskContents(){pdf.addPage();addHeader();let tasklist=global_pdf.tasks;let inner_margin_A=left_margin+20;for(let i=0;i<global_pdf.tasks.length;i++){pdf.setLineWidth(0.5);pdf.setDrawColor(15,15,15);pdf.rect(left_margin,content_margin-3,5,5);pdf.text(left_margin+1,content_margin+1,labels[i%labels.length]);pdf.text(inner_margin_A,content_margin,tasklist[i].folder_num);pdf.text(inner_margin_A+60,content_margin,''+tasklist[i].folder);pdf.text(inner_margin_A,content_margin+5,''+tasklist[i].people);pdf.text(inner_margin_A,content_margin+10,'FP: '+tasklist[i].fp);pdf.text(inner_margin_A+60,content_margin+10,'PP: '+tasklist[i].pp);pdf.text(inner_margin_A,content_margin+15,'Time: '+tasklist[i].leg_time+'');pdf.text(inner_margin_A+60,content_margin+15,'Distance: '+tasklist[i].leg_dist+'');if(i==global_pdf.tasks.length-1){content_margin+=40;pdf.setFontType("bold");pdf.text(left_margin,content_margin,'Trip Time: '+global_pdf.trip_time+" minutes");pdf.text(left_margin+80,content_margin,'Trip Distance: '+global_pdf.trip_dist+" miles");}else if(content_margin>=PAGE_HEIGHT-80){pdf.addPage();page_count=page_count+1;addFooter()
content_margin=30;}else{addLine("thin",content_margin+18);content_margin+=27;}}
function callback(){alert("done!");}
pdf.output('datauri',{},callback);}
addHeader();addGoogleMapImage();}
$("#createPDF").on('click',function(){console.log('printing....');$("#loading-overlay").fadeIn("slow");createFinalPDF();});});